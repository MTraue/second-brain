<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Brain - Lokale Version</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons als SVG-Komponenten
        const Search = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Plus = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Brain = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"></path>
                <path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path>
            </svg>
        );

        const Download = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Edit2 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Save = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );

        const X = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Link = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
        );

        const Sparkles = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
                <path d="M5 3v4"></path>
                <path d="M19 17v4"></path>
                <path d="M3 5h4"></path>
                <path d="M17 19h4"></path>
            </svg>
        );

        const ChevronRight = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const ChevronDown = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        // LocalStorage API Mock für localStorage
        const storage = {
            get: async (key) => {
                const value = localStorage.getItem(key);
                return value ? { key, value } : null;
            },
            set: async (key, value) => {
                localStorage.setItem(key, value);
                return { key, value };
            },
            delete: async (key) => {
                localStorage.removeItem(key);
                return { key, deleted: true };
            },
            list: async (prefix) => {
                const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix || ''));
                return { keys };
            }
        };

        function SecondBrain() {
            const [notes, setNotes] = useState([]);
            const [selectedNote, setSelectedNote] = useState(null);
            const [isEditing, setIsEditing] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedTags, setSelectedTags] = useState([]);
            const [showNewNoteForm, setShowNewNoteForm] = useState(false);
            const [aiLoading, setAiLoading] = useState(false);
            const [expandedNotes, setExpandedNotes] = useState({});
            const [apiKey, setApiKey] = useState('');
            const [showApiKeyDialog, setShowApiKeyDialog] = useState(false);
            
            const [newNote, setNewNote] = useState({
                title: '',
                content: '',
                tags: []
            });

            useEffect(() => {
                loadNotes();
                const savedApiKey = localStorage.getItem('anthropic_api_key');
                if (savedApiKey) {
                    setApiKey(savedApiKey);
                }
            }, []);

            const loadNotes = async () => {
                try {
                    const result = await storage.list('note:');
                    if (result && result.keys) {
                        const loadedNotes = await Promise.all(
                            result.keys.map(async (key) => {
                                const noteData = await storage.get(key);
                                return noteData ? JSON.parse(noteData.value) : null;
                            })
                        );
                        setNotes(loadedNotes.filter(note => note !== null));
                    }
                } catch (error) {
                    console.log('Keine Notizen gefunden, starte neu');
                }
            };

            const saveNote = async (note) => {
                try {
                    await storage.set(`note:${note.id}`, JSON.stringify(note));
                } catch (error) {
                    console.error('Fehler beim Speichern:', error);
                    alert('Fehler beim Speichern der Notiz');
                }
            };

            const deleteNoteFromStorage = async (noteId) => {
                try {
                    await storage.delete(`note:${noteId}`);
                } catch (error) {
                    console.error('Fehler beim Löschen:', error);
                }
            };

            const createNote = async () => {
                if (!newNote.title.trim()) {
                    alert('Bitte gib einen Titel ein');
                    return;
                }

                const note = {
                    id: Date.now().toString(),
                    title: newNote.title,
                    content: newNote.content,
                    tags: newNote.tags,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    linkedNotes: []
                };

                await saveNote(note);
                setNotes([...notes, note]);
                setNewNote({ title: '', content: '', tags: [] });
                setShowNewNoteForm(false);
                setSelectedNote(note);
            };

            const updateNote = async () => {
                if (!selectedNote) return;

                const updatedNote = {
                    ...selectedNote,
                    updatedAt: new Date().toISOString()
                };

                await saveNote(updatedNote);
                setNotes(notes.map(n => n.id === updatedNote.id ? updatedNote : n));
                setIsEditing(false);
            };

            const deleteNote = async (noteId) => {
                if (!confirm('Möchtest du diese Notiz wirklich löschen?')) return;

                await deleteNoteFromStorage(noteId);
                setNotes(notes.filter(n => n.id !== noteId));
                if (selectedNote?.id === noteId) {
                    setSelectedNote(null);
                }
            };

            const addTag = (tag, isNewNote = false) => {
                if (!tag.trim()) return;
                
                if (isNewNote) {
                    if (!newNote.tags.includes(tag)) {
                        setNewNote({ ...newNote, tags: [...newNote.tags, tag] });
                    }
                } else if (selectedNote && !selectedNote.tags.includes(tag)) {
                    setSelectedNote({ ...selectedNote, tags: [...selectedNote.tags, tag] });
                }
            };

            const removeTag = (tag, isNewNote = false) => {
                if (isNewNote) {
                    setNewNote({ ...newNote, tags: newNote.tags.filter(t => t !== tag) });
                } else if (selectedNote) {
                    setSelectedNote({ ...selectedNote, tags: selectedNote.tags.filter(t => t !== tag) });
                }
            };

            const getAllTags = () => {
                const tagSet = new Set();
                notes.forEach(note => note.tags.forEach(tag => tagSet.add(tag)));
                return Array.from(tagSet).sort();
            };

            const linkNotes = (noteId1, noteId2) => {
                const note1 = notes.find(n => n.id === noteId1);
                const note2 = notes.find(n => n.id === noteId2);
                
                if (!note1 || !note2) return;

                if (!note1.linkedNotes.includes(noteId2)) {
                    note1.linkedNotes.push(noteId2);
                    saveNote(note1);
                }
                if (!note2.linkedNotes.includes(noteId1)) {
                    note2.linkedNotes.push(noteId1);
                    saveNote(note2);
                }

                setNotes([...notes]);
            };

            const saveApiKey = () => {
                localStorage.setItem('anthropic_api_key', apiKey);
                setShowApiKeyDialog(false);
                alert('API-Key gespeichert!');
            };

            const getAISuggestions = async (type) => {
                if (!selectedNote) return;
                
                if (!apiKey) {
                    setShowApiKeyDialog(true);
                    return;
                }
                
                setAiLoading(true);
                try {
                    let prompt = '';
                    
                    if (type === 'summary') {
                        prompt = `Fasse diese Notiz kurz zusammen:\n\nTitel: ${selectedNote.title}\n\n${selectedNote.content}`;
                    } else if (type === 'expand') {
                        prompt = `Erweitere diese Idee mit zusätzlichen Gedanken und Perspektiven:\n\nTitel: ${selectedNote.title}\n\n${selectedNote.content}`;
                    } else if (type === 'connections') {
                        const otherNotes = notes.filter(n => n.id !== selectedNote.id).map(n => `- ${n.title}`).join('\n');
                        prompt = `Analysiere diese Notiz und schlage vor, welche der anderen Notizen thematisch verbunden sein könnten.\n\nAktuelle Notiz:\nTitel: ${selectedNote.title}\nInhalt: ${selectedNote.content}\n\nAndere Notizen:\n${otherNotes}\n\nAntworte nur mit den Titeln der verbundenen Notizen, jeweils in einer neuen Zeile.`;
                    } else if (type === 'tags') {
                        prompt = `Schlage passende Tags für diese Notiz vor:\n\nTitel: ${selectedNote.title}\n\n${selectedNote.content}\n\nAntworte nur mit den Tags, getrennt durch Kommas.`;
                    }

                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": apiKey,
                            "anthropic-version": "2023-06-01"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 1000,
                            messages: [
                                { role: "user", content: prompt }
                            ],
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API-Fehler: ${response.status}`);
                    }

                    const data = await response.json();
                    const aiResponse = data.content.map(item => item.type === "text" ? item.text : "").join("\n");

                    if (type === 'summary' || type === 'expand') {
                        setSelectedNote({
                            ...selectedNote,
                            content: selectedNote.content + '\n\n---\n**KI-' + (type === 'summary' ? 'Zusammenfassung' : 'Erweiterung') + ':**\n' + aiResponse
                        });
                    } else if (type === 'tags') {
                        const suggestedTags = aiResponse.split(',').map(t => t.trim()).filter(t => t);
                        suggestedTags.forEach(tag => addTag(tag));
                    } else if (type === 'connections') {
                        alert('Vorgeschlagene Verbindungen:\n' + aiResponse);
                    }
                } catch (error) {
                    console.error('AI-Fehler:', error);
                    alert('Fehler bei der KI-Anfrage: ' + error.message + '\n\nBitte überprüfe deinen API-Key.');
                } finally {
                    setAiLoading(false);
                }
            };

            const exportToMarkdown = () => {
                const markdown = notes.map(note => {
                    let md = `# ${note.title}\n\n`;
                    md += `**Erstellt:** ${new Date(note.createdAt).toLocaleDateString('de-DE')}\n`;
                    md += `**Tags:** ${note.tags.join(', ')}\n\n`;
                    md += note.content + '\n\n';
                    
                    if (note.linkedNotes.length > 0) {
                        md += '## Verknüpfte Notizen\n';
                        note.linkedNotes.forEach(linkedId => {
                            const linkedNote = notes.find(n => n.id === linkedId);
                            if (linkedNote) {
                                md += `- [[${linkedNote.title}]]\n`;
                            }
                        });
                        md += '\n';
                    }
                    
                    md += '---\n\n';
                    return md;
                }).join('\n');

                const blob = new Blob([markdown], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'second-brain-export.md';
                a.click();
            };

            const filteredNotes = notes.filter(note => {
                const matchesSearch = note.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                     note.content.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesTags = selectedTags.length === 0 || 
                                   selectedTags.every(tag => note.tags.includes(tag));
                return matchesSearch && matchesTags;
            });

            const toggleExpand = (noteId) => {
                setExpandedNotes(prev => ({
                    ...prev,
                    [noteId]: !prev[noteId]
                }));
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* API Key Dialog */}
                        {showApiKeyDialog && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-slate-800 p-6 rounded-lg max-w-md w-full">
                                    <h2 className="text-2xl font-bold mb-4">Anthropic API-Key</h2>
                                    <p className="mb-4 text-slate-300">Für KI-Funktionen benötigst du einen Anthropic API-Key.</p>
                                    <p className="mb-4 text-sm text-slate-400">Erhalte deinen Key auf: <a href="https://console.anthropic.com" target="_blank" className="text-purple-400 underline">console.anthropic.com</a></p>
                                    <input
                                        type="password"
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        placeholder="sk-ant-..."
                                        className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg mb-4"
                                    />
                                    <div className="flex gap-2">
                                        <button
                                            onClick={saveApiKey}
                                            className="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg"
                                        >
                                            Speichern
                                        </button>
                                        <button
                                            onClick={() => setShowApiKeyDialog(false)}
                                            className="flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg"
                                        >
                                            Abbrechen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Header */}
                        <div className="mb-8">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <Brain className="w-10 h-10 text-purple-400" />
                                    <h1 className="text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                                        Second Brain
                                    </h1>
                                    <span className="text-sm text-slate-400">(Lokale Version)</span>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowApiKeyDialog(true)}
                                        className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm"
                                    >
                                        ⚙️ API-Key
                                    </button>
                                    <button
                                        onClick={() => setShowNewNoteForm(true)}
                                        className="flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition"
                                    >
                                        <Plus className="w-5 h-5" />
                                        Neue Notiz
                                    </button>
                                    <button
                                        onClick={exportToMarkdown}
                                        className="flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition"
                                    >
                                        <Download className="w-5 h-5" />
                                        Export
                                    </button>
                                </div>
                            </div>
                            
                            {/* Search and Filter */}
                            <div className="flex gap-4 items-center">
                                <div className="flex-1 relative">
                                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" />
                                    <input
                                        type="text"
                                        placeholder="Suche in Notizen..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:border-purple-500"
                                    />
                                </div>
                                <div className="flex gap-2 flex-wrap">
                                    {getAllTags().map(tag => (
                                        <button
                                            key={tag}
                                            onClick={() => {
                                                if (selectedTags.includes(tag)) {
                                                    setSelectedTags(selectedTags.filter(t => t !== tag));
                                                } else {
                                                    setSelectedTags([...selectedTags, tag]);
                                                }
                                            }}
                                            className={`px-3 py-1 rounded-full text-sm transition ${
                                                selectedTags.includes(tag)
                                                    ? 'bg-purple-600 text-white'
                                                    : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                            }`}
                                        >
                                            #{tag}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* New Note Form */}
                        {showNewNoteForm && (
                            <div className="mb-6 p-6 bg-slate-800 rounded-lg border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold">Neue Notiz erstellen</h2>
                                    <button onClick={() => setShowNewNoteForm(false)}>
                                        <X className="w-6 h-6" />
                                    </button>
                                </div>
                                <input
                                    type="text"
                                    placeholder="Titel"
                                    value={newNote.title}
                                    onChange={(e) => setNewNote({ ...newNote, title: e.target.value })}
                                    className="w-full mb-4 px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-purple-500"
                                />
                                <textarea
                                    placeholder="Inhalt (Markdown unterstützt)"
                                    value={newNote.content}
                                    onChange={(e) => setNewNote({ ...newNote, content: e.target.value })}
                                    className="w-full mb-4 px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-purple-500 h-40 resize-none"
                                />
                                <div className="mb-4">
                                    <div className="flex gap-2 mb-2">
                                        <input
                                            type="text"
                                            placeholder="Tag hinzufügen..."
                                            onKeyDown={(e) => {
                                                if (e.key === 'Enter') {
                                                    addTag(e.target.value, true);
                                                    e.target.value = '';
                                                }
                                            }}
                                            className="flex-1 px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-purple-500"
                                        />
                                    </div>
                                    <div className="flex gap-2 flex-wrap">
                                        {newNote.tags.map(tag => (
                                            <span key={tag} className="px-3 py-1 bg-purple-600 rounded-full text-sm flex items-center gap-2">
                                                #{tag}
                                                <button onClick={() => removeTag(tag, true)}>
                                                    <X className="w-4 h-4" />
                                                </button>
                                            </span>
                                        ))}
                                    </div>
                                </div>
                                <button
                                    onClick={createNote}
                                    className="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition"
                                >
                                    Notiz erstellen
                                </button>
                            </div>
                        )}

                        {/* Main Content */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Notes List */}
                            <div className="lg:col-span-1 space-y-3 max-h-[600px] overflow-y-auto">
                                {filteredNotes.length === 0 ? (
                                    <div className="text-center py-12 text-slate-400">
                                        <Brain className="w-16 h-16 mx-auto mb-4 opacity-50" />
                                        <p>Keine Notizen gefunden</p>
                                        <p className="text-sm">Erstelle deine erste Notiz!</p>
                                    </div>
                                ) : (
                                    filteredNotes.map(note => (
                                        <div
                                            key={note.id}
                                            className={`p-4 rounded-lg cursor-pointer transition ${
                                                selectedNote?.id === note.id
                                                    ? 'bg-purple-600'
                                                    : 'bg-slate-800 hover:bg-slate-700'
                                            }`}
                                        >
                                            <div className="flex items-start justify-between mb-2">
                                                <h3
                                                    onClick={() => setSelectedNote(note)}
                                                    className="font-semibold text-lg flex-1"
                                                >
                                                    {note.title}
                                                </h3>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        deleteNote(note.id);
                                                    }}
                                                    className="text-red-400 hover:text-red-300"
                                                >
                                                    <Trash2 className="w-4 h-4" />
                                                </button>
                                            </div>
                                            <p className="text-sm text-slate-300 mb-2 line-clamp-2">
                                                {note.content.substring(0, 100)}...
                                            </p>
                                            <div className="flex gap-2 flex-wrap">
                                                {note.tags.map(tag => (
                                                    <span key={tag} className="px-2 py-1 bg-slate-900 rounded text-xs">
                                                        #{tag}
                                                    </span>
                                                ))}
                                            </div>
                                            {note.linkedNotes.length > 0 && (
                                                <div className="mt-2 pt-2 border-t border-slate-700">
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            toggleExpand(note.id);
                                                        }}
                                                        className="flex items-center gap-1 text-sm text-slate-400 hover:text-slate-300"
                                                    >
                                                        {expandedNotes[note.id] ? <ChevronDown className="w-4 h-4" /> : <ChevronRight className="w-4 h-4" />}
                                                        <Link className="w-4 h-4" />
                                                        {note.linkedNotes.length} Verknüpfungen
                                                    </button>
                                                    {expandedNotes[note.id] && (
                                                        <div className="mt-2 ml-5 space-y-1">
                                                            {note.linkedNotes.map(linkedId => {
                                                                const linkedNote = notes.find(n => n.id === linkedId);
                                                                return linkedNote ? (
                                                                    <button
                                                                        key={linkedId}
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            setSelectedNote(linkedNote);
                                                                        }}
                                                                        className="text-xs text-purple-400 hover:text-purple-300 block"
                                                                    >
                                                                        → {linkedNote.title}
                                                                    </button>
                                                                ) : null;
                                                            })}
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    ))
                                )}
                            </div>

                            {/* Note Detail */}
                            <div className="lg:col-span-2">
                                {selectedNote ? (
                                    <div className="bg-slate-800 rounded-lg p-6 border border-slate-700">
                                        <div className="flex justify-between items-start mb-6">
                                            <div className="flex-1">
                                                {isEditing ? (
                                                    <input
                                                        type="text"
                                                        value={selectedNote.title}
                                                        onChange={(e) => setSelectedNote({ ...selectedNote, title: e.target.value })}
                                                        className="w-full text-3xl font-bold bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:border-purple-500"
                                                    />
                                                ) : (
                                                    <h2 className="text-3xl font-bold mb-4">{selectedNote.title}</h2>
                                                )}
                                                <p className="text-sm text-slate-400">
                                                    Erstellt: {new Date(selectedNote.createdAt).toLocaleDateString('de-DE')}
                                                    {selectedNote.updatedAt !== selectedNote.createdAt && (
                                                        <> • Aktualisiert: {new Date(selectedNote.updatedAt).toLocaleDateString('de-DE')}</>
                                                    )}
                                                </p>
                                            </div>
                                            <div className="flex gap-2">
                                                {isEditing ? (
                                                    <>
                                                        <button
                                                            onClick={updateNote}
                                                            className="p-2 bg-green-600 hover:bg-green-700 rounded-lg transition"
                                                        >
                                                            <Save className="w-5 h-5" />
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                setIsEditing(false);
                                                                setSelectedNote(notes.find(n => n.id === selectedNote.id));
                                                            }}
                                                            className="p-2 bg-slate-600 hover:bg-slate-500 rounded-lg transition"
                                                        >
                                                            <X className="w-5 h-5" />
                                                        </button>
                                                    </>
                                                ) : (
                                                    <button
                                                        onClick={() => setIsEditing(true)}
                                                        className="p-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition"
                                                    >
                                                        <Edit2 className="w-5 h-5" />
                                                    </button>
                                                )}
                                            </div>
                                        </div>

                                        {/* Tags */}
                                        <div className="mb-6">
                                            {isEditing && (
                                                <input
                                                    type="text"
                                                    placeholder="Tag hinzufügen (Enter drücken)"
                                                    onKeyDown={(e) => {
                                                        if (e.key === 'Enter') {
                                                            addTag(e.target.value);
                                                            e.target.value = '';
                                                        }
                                                    }}
                                                    className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-purple-500 mb-2"
                                                />
                                            )}
                                            <div className="flex gap-2 flex-wrap">
                                                {selectedNote.tags.map(tag => (
                                                    <span key={tag} className="px-3 py-1 bg-purple-600 rounded-full text-sm flex items-center gap-2">
                                                        #{tag}
                                                        {isEditing && (
                                                            <button onClick={() => removeTag(tag)}>
                                                                <X className="w-4 h-4" />
                                                            </button>
                                                        )}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Content */}
                                        {isEditing ? (
                                            <textarea
                                                value={selectedNote.content}
                                                onChange={(e) => setSelectedNote({ ...selectedNote, content: e.target.value })}
                                                className="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-purple-500 h-64 resize-none mb-6"
                                            />
                                        ) : (
                                            <div className="prose prose-invert max-w-none mb-6 whitespace-pre-wrap">
                                                {selectedNote.content}
                                            </div>
                                        )}

                                        {/* AI Actions */}
                                        {!isEditing && (
                                            <div className="mb-6 p-4 bg-slate-900 rounded-lg">
                                                <div className="flex items-center gap-2 mb-3">
                                                    <Sparkles className="w-5 h-5 text-purple-400" />
                                                    <h3 className="font-semibold">KI-Assistenz</h3>
                                                    {!apiKey && <span className="text-xs text-yellow-400">(API-Key erforderlich)</span>}
                                                </div>
                                                <div className="flex gap-2 flex-wrap">
                                                    <button
                                                        onClick={() => getAISuggestions('summary')}
                                                        disabled={aiLoading}
                                                        className="px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition disabled:opacity-50"
                                                    >
                                                        Zusammenfassen
                                                    </button>
                                                    <button
                                                        onClick={() => getAISuggestions('expand')}
                                                        disabled={aiLoading}
                                                        className="px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition disabled:opacity-50"
                                                    >
                                                        Erweitern
                                                    </button>
                                                    <button
                                                        onClick={() => getAISuggestions('tags')}
                                                        disabled={aiLoading}
                                                        className="px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition disabled:opacity-50"
                                                    >
                                                        Tags vorschlagen
                                                    </button>
                                                    <button
                                                        onClick={() => getAISuggestions('connections')}
                                                        disabled={aiLoading}
                                                        className="px-3 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm transition disabled:opacity-50"
                                                    >
                                                        Verknüpfungen finden
                                                    </button>
                                                </div>
                                                {aiLoading && (
                                                    <div className="mt-3 text-sm text-purple-400 flex items-center gap-2">
                                                        <div className="animate-spin rounded-full h-4 w-4 border-2 border-purple-400 border-t-transparent"></div>
                                                        KI arbeitet...
                                                    </div>
                                                )}
                                            </div>
                                        )}

                                        {/* Linked Notes */}
                                        <div className="border-t border-slate-700 pt-4">
                                            <div className="flex items-center gap-2 mb-3">
                                                <Link className="w-5 h-5 text-purple-400" />
                                                <h3 className="font-semibold">Verknüpfte Notizen</h3>
                                            </div>
                                            {isEditing && (
                                                <select
                                                    onChange={(e) => {
                                                        if (e.target.value) {
                                                            linkNotes(selectedNote.id, e.target.value);
                                                            e.target.value = '';
                                                        }
                                                    }}
                                                    className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-purple-500 mb-3"
                                                >
                                                    <option value="">Notiz verknüpfen...</option>
                                                    {notes
                                                        .filter(n => n.id !== selectedNote.id && !selectedNote.linkedNotes.includes(n.id))
                                                        .map(note => (
                                                            <option key={note.id} value={note.id}>
                                                                {note.title}
                                                            </option>
                                                        ))}
                                                </select>
                                            )}
                                            <div className="space-y-2">
                                                {selectedNote.linkedNotes.length === 0 ? (
                                                    <p className="text-sm text-slate-400">Keine Verknüpfungen</p>
                                                ) : (
                                                    selectedNote.linkedNotes.map(linkedId => {
                                                        const linkedNote = notes.find(n => n.id === linkedId);
                                                        return linkedNote ? (
                                                            <button
                                                                key={linkedId}
                                                                onClick={() => setSelectedNote(linkedNote)}
                                                                className="block w-full p-3 bg-slate-900 hover:bg-slate-700 rounded-lg text-left transition"
                                                            >
                                                                <div className="font-semibold">{linkedNote.title}</div>
                                                                <div className="text-sm text-slate-400 line-clamp-1">
                                                                    {linkedNote.content.substring(0, 80)}...
                                                                </div>
                                                            </button>
                                                        ) : null;
                                                    })
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-slate-800 rounded-lg p-12 border border-slate-700 text-center">
                                        <Brain className="w-20 h-20 mx-auto mb-4 text-slate-600" />
                                        <p className="text-xl text-slate-400">Wähle eine Notiz aus oder erstelle eine neue</p>
                                        <p className="text-sm text-slate-500 mt-2">💾 Alle Daten werden lokal in deinem Browser gespeichert</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SecondBrain />);
    </script>
</body>
</html>
